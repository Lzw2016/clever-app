# clever-app

ä¸€ä¸ªè½»é‡çº§çš„Java Webæ¡†æ¶ï¼Œå¼ºè°ƒç®€æ´ã€é€æ˜ã€é«˜æ•ˆã€‚åŸºäºSpringBootï¼Œåªå¢å¼ºè€Œä¸æ”¹å˜ï¼Œä¸ºæ‚¨å¸¦æ¥çº¯ç²¹çš„å¼€å‘ä½“éªŒã€‚

## ç‰¹ç‚¹

#### å…¼å®¹SpringBoot

é‡‡ç”¨SpringBootæŠ€æœ¯æ„å»ºï¼Œæ— ç¼èå…¥Springç”Ÿæ€ä»¥åŠIDEæ”¯æŒã€‚å¯ä»¥ç›´æ¥ä½¿ç”¨SpringBootç”Ÿæ€ç»„ä»¶ï¼Œä½“éªŒä¸€è‡´çš„ä¾¿æ·å¼€å‘ã€‚

#### å¯åŠ¨æ—¶é—´çŸ­ä¸”ç¨³å®š

åœ¨SpringBooté¡¹ç›®ä¸­ï¼Œéšç€é¡¹ç›®è§„æ¨¡çš„æ‰©å¤§å’Œä¾èµ–é¡¹çš„å¢å¤šï¼Œå¯åŠ¨æ—¶é—´å¾€å¾€ä¼šæ˜¾è‘—å¢åŠ ï¼Œæˆ‘å‚ä¸çš„è®¸å¤šé¡¹ç›®å¯åŠ¨æ—¶é—´éƒ½è¶…è¿‡äº†1åˆ†é’Ÿï¼Œæœ‰çš„ç”šè‡³è¾¾åˆ°äº†3åˆ†é’Ÿã€‚
ç„¶è€Œï¼Œæˆ‘ä»¬é‡‡ç”¨äº†ä¸€ç§ä¸åŒçš„æ–¹æ³•ï¼šå‡½æ•°å¼ç¼–ç¨‹æ¨¡å¼ï¼Œè¿™ä½¿å¾—ç³»ç»Ÿå¯åŠ¨æ—¶é—´å¤§å¹…ç¼©çŸ­ï¼Œä»…éœ€3åˆ°10ç§’ã€‚
è¿™ç§é€Ÿåº¦çš„æå‡ä¸å—é¡¹ç›®è§„æ¨¡æˆ–ä¾èµ–æ•°é‡çš„å½±å“ã€‚

ä»¥ä¸‹æ˜¯æˆ‘çš„æµ‹è¯•ç»“æœï¼š

- åœ¨12ä»£i7å¤„ç†å™¨ä¸Šï¼Œå¯åŠ¨æ—¶é—´ä»…éœ€3ç§’ã€‚
- åœ¨8ä»£i5å¤„ç†å™¨ä¸Šï¼Œå¯åŠ¨æ—¶é—´ä¹Ÿä»…ä¸º9ç§’ã€‚

è¿™ç§å¿«é€Ÿå¯åŠ¨çš„èƒ½åŠ›ï¼Œä¸ºå¤§å‹é¡¹ç›®çš„å¼€å‘å’Œéƒ¨ç½²å¸¦æ¥äº†æ˜¾è‘—çš„ä¼˜åŠ¿ã€‚

#### ä»£ç å³æ”¹å³ç”Ÿæ•ˆ

æä¾›äº†å¼ºå¤§çš„ç±»çƒ­é‡è½½åŠŸèƒ½ï¼Œè¿™æ„å‘³ç€æ‚¨åœ¨å¼€å‘è¿‡ç¨‹ä¸­æ— éœ€é‡å¯æœåŠ¡å³å¯å®æ—¶æŸ¥çœ‹ä»£ç æ›´æ”¹çš„æ•ˆæœã€‚
åªéœ€é€šè¿‡IDEè¿›è¡Œå¢é‡ç¼–è¯‘ï¼Œæ”¹åŠ¨çš„ä»£ç å³åˆ»ç”Ÿæ•ˆï¼Œå®Œå…¨ä¸éœ€è¦ä¾èµ–åƒ`jrebel`è¿™æ ·çš„å·¥å…·ã€‚
æ›´ä»¤äººå…´å¥‹çš„æ˜¯ï¼Œå†…ç½®çš„çƒ­é‡è½½æŠ€æœ¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­åŒæ ·ç¨³å®šå¯é ã€‚åœ¨é¡¹ç›®å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä»ä»£ç ä¿®æ”¹åˆ°ç”Ÿæ•ˆçš„æ—¶é—´é€šå¸¸åœ¨3ç§’ä»¥å†…ã€‚
è¿™æ ·çš„æ•ˆç‡æå‡ï¼Œè®©æ‚¨çš„å¼€å‘æµç¨‹æ›´åŠ æµç•…ï¼Œå‡å°‘äº†ç­‰å¾…æ—¶é—´ï¼Œæé«˜äº†ç”Ÿäº§åŠ›ã€‚

#### æ”¯æŒKotlin

æ¨èä½¿ç”¨Kotlinçš„å‡½æ•°å¼ç¼–ç¨‹æ¨¡å¼ï¼Œå®ƒèƒ½å¤Ÿç®€åŒ–æ‚¨çš„ä¸šåŠ¡å¼€å‘æµç¨‹ï¼Œè®©æ‚¨æ‘†è„±ä¼ ç»Ÿçš„Controller/Service/Daoæ¨¡å¼ã€‚
é‡‡ç”¨Kotlinï¼Œæ‚¨å¯ä»¥äº«å—åˆ°ç±»ä¼¼Goè¯­è¨€çš„ç®€æ´å’Œé«˜æ•ˆã€‚
æ­¤å¤–ï¼Œä¹Ÿå®Œå…¨æ”¯æŒJavaï¼Œä»¥åŠæ ‡å‡†çš„SpringBootå¼€å‘æ¨¡å¼ï¼Œç¡®ä¿æ‚¨èƒ½å¤Ÿæ ¹æ®è‡ªå·±çš„å–œå¥½å’Œé¡¹ç›®éœ€æ±‚çµæ´»é€‰æ‹©ã€‚

#### å¯è§‚æµ‹æ€§ä¼˜å…ˆ

- **å¯åŠ¨æ—¥å¿—**ï¼šåº”ç”¨å¯åŠ¨æ—¶ï¼Œå…³é”®é…ç½®ä¿¡æ¯ä¸€ç›®äº†ç„¶ï¼Œç¡®ä¿é…ç½®ç¯å¢ƒå‡†ç¡®æ— è¯¯ã€‚
- **æ•°æ®åº“æ—¥å¿—**ï¼šå†…ç½®ORMè‡ªåŠ¨è®°å½•SQLæ‰§è¡Œã€äº‹åŠ¡æ“ä½œåŠæ…¢æŸ¥è¯¢ï¼Œè®©æ•°æ®åº“äº¤äº’æ¸…æ™°å¯è§ã€‚
- **è¯·æ±‚æ—¥å¿—**ï¼šè¯¦ç»†è®°å½•ç”¨æˆ·è¯·æ±‚å’Œå¤„ç†æ—¶é—´ï¼Œæ…¢æ¥å£æ— å¤„è—èº«ã€‚

#### å¤šæ•°æ®æºæ”¯æŒ

æä¾›çµæ´»çš„å¤šæ•°æ®æºæ”¯æŒï¼Œè½»æ¾è¿æ¥å’Œç®¡ç†JDBCã€Redisã€MongoDBã€RabbitMQç­‰å¤šç§æ•°æ®æºã€‚
å¯ä»¥åœ¨è¿è¡Œæ—¶è‡ªç”±åˆ‡æ¢å’ŒåŠ¨æ€æ·»åŠ æ•°æ®æºï¼Œæ— éœ€ä¾èµ–AOPæˆ–AbstractRoutingDataSourceç­‰å¤æ‚æœºåˆ¶ã€‚
ç›´æ¥æ“ä½œåº•å±‚APIï¼Œè®©æ•°æ®æºç®¡ç†å˜å¾—ç›´è§‚è€Œç®€å•ã€‚

#### å†…ç½®å®šæ—¶ä»»åŠ¡

- **å•èŠ‚ç‚¹å®šæ—¶ä»»åŠ¡**ï¼šä¸€ä¸ªè½»é‡çº§çš„çº¿ç¨‹æ± è°ƒåº¦å™¨ï¼Œä¸ä¾èµ–æ•°æ®åº“ï¼Œç›´æ¥åœ¨`application.yml`æ–‡ä»¶ä¸­é…ç½®ä»»åŠ¡ã€‚
- **åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡**ï¼šä¸€ä¸ªä»…ä¾èµ–æ•°æ®åº“çš„åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦æœåŠ¡ï¼Œä¸“ä¸ºé›†ç¾¤ç¯å¢ƒè®¾è®¡ï¼Œæ”¯æŒé€šè¿‡å‘½åç©ºé—´å®ç°é›†ç¾¤çš„éš”ç¦»ã€‚

ä¸¤ç§æ–¹æ¡ˆï¼Œæ»¡è¶³ä¸åŒè§„æ¨¡çš„åº”ç”¨éœ€æ±‚ï¼Œè®©å®šæ—¶ä»»åŠ¡ç®¡ç†æ—¢ç®€å•åˆå¼ºå¤§ã€‚

#### å†…ç½®JSå¼•æ“

å†…ç½®å¤šç§JavaScriptå¼•æ“ï¼Œæ”¯æŒçµæ´»çš„ä¸šåŠ¡é€»è¾‘åŠ¨æ€è°ƒæ•´ï¼š

- **Nashorn**ï¼šé€‚ç”¨äºJDK8åŠä»¥å‰çš„ç‰ˆæœ¬ï¼ŒJDKå†…ç½®çš„JavaScriptå¼•æ“ï¼Œä¸Javaç¨‹åºæ— ç¼é›†æˆï¼Œä½†æ€§èƒ½ç›¸å¯¹è¾ƒä½ã€‚
- **GraalJS**ï¼šé€‚ç”¨äºJDK8åŠä»¥åçš„ç‰ˆæœ¬ï¼Œç”±GraalVMæä¾›æ”¯æŒï¼Œä¸Javaç¨‹åºäº¤äº’æµç•…ï¼Œæ€§èƒ½ä¼˜å¼‚ã€‚
- **V8**ï¼šGoogleå¼€æºçš„é«˜æ€§èƒ½JavaScriptå¼•æ“ï¼Œè™½ç„¶ä¸Javaç¨‹åºçš„äº¤äº’ç¨æ˜¾å¤æ‚ï¼Œä½†æ€§èƒ½å“è¶Šã€‚

æ ¹æ®æ‚¨çš„éœ€æ±‚ï¼Œè½»æ¾é€‰æ‹©æœ€é€‚åˆçš„JavaScriptå¼•æ“ï¼Œå®ç°ç”Ÿäº§ç¯å¢ƒè¿è¡Œæ—¶é«˜æ•ˆçµæ´»çš„ä¸šåŠ¡é€»è¾‘è°ƒæ•´ã€‚

#### æ”¯æŒJDK17

éšç€SpringBoot3çš„æ¨å‡ºï¼Œæˆ‘ä»¬æ¨èä½¿ç”¨JDK 17åŠä»¥ä¸Šç‰ˆæœ¬ä»¥è·å¾—æœ€ä½³æ€§èƒ½ã€‚
é€‰æ‹©JDK 21ï¼Œæ‚¨å°†äº«å—åˆ°è™šæ‹Ÿçº¿ç¨‹ç­‰åˆ›æ–°ç‰¹æ€§ï¼Œè¿›ä¸€æ­¥æå‡æ‚¨çš„å¼€å‘ä½“éªŒå’Œæ€§èƒ½ã€‚
åˆ‡æ¢åˆ°`springboot3.x`åˆ†æ”¯ä»¥é€‚é…è¿™äº›å…ˆè¿›çš„Javaç‰ˆæœ¬ã€‚

## å¼€å§‹ä½¿ç”¨

#### Mavenä½¿ç”¨

```xml
<project>
    <!-- å¢åŠ  maven ç§æœ -->
    <repositories>
        <repository>
            <id>gitea</id>
            <url>http://all.msvc.top:30005/api/packages/clever/maven</url>
        </repository>
    </repositories>
    <!-- æŒ‡å®šç‰ˆæœ¬ -->
    <properties>
        <cleverVersion>3.3.4.0-SNAPSHOT</cleverVersion>
    </properties>
    <!-- æŒ‰éœ€å¼•å…¥ä¾èµ– -->
    <dependencies>
        <dependency>
            <groupId>org.clever</groupId>
            <artifactId>clever-spring</artifactId>
            <version>${cleverVersion}</version>
        </dependency>
        <dependency>
            <groupId>org.clever</groupId>
            <artifactId>clever-core</artifactId>
            <version>${cleverVersion}</version>
        </dependency>
        <dependency>
            <groupId>org.clever</groupId>
            <artifactId>clever-data-jdbc</artifactId>
            <version>${cleverVersion}</version>
        </dependency>
        <dependency>
            <groupId>org.clever</groupId>
            <artifactId>clever-data-redis</artifactId>
            <version>${cleverVersion}</version>
        </dependency>
        <dependency>
            <groupId>org.clever</groupId>
            <artifactId>clever-web</artifactId>
            <version>${cleverVersion}</version>
        </dependency>
        <dependency>
            <groupId>org.clever</groupId>
            <artifactId>clever-security</artifactId>
            <version>${cleverVersion}</version>
        </dependency>
        <dependency>
            <groupId>org.clever</groupId>
            <artifactId>clever-task</artifactId>
            <version>${cleverVersion}</version>
        </dependency>
        <dependency>
            <groupId>org.clever</groupId>
            <artifactId>clever-task-ext</artifactId>
            <version>${cleverVersion}</version>
        </dependency>
    </dependencies>
</project>
```

#### Gradleä½¿ç”¨(kotlin)

```kotlin
repositories {
    // å¢åŠ  maven ç§æœ
    maven(url = "http://all.msvc.top:30005/api/packages/clever/maven/") {
        isAllowInsecureProtocol = true
    }
}
// æŒ‡å®šç‰ˆæœ¬
val cleverVersion = "3.3.4.0-SNAPSHOT"
dependencies {
    // æŒ‰éœ€å¼•å…¥ä¾èµ–
    api("org.clever:clever-spring:${cleverVersion}")
    api("org.clever:clever-core:${cleverVersion}")
    api("org.clever:clever-data-jdbc:${cleverVersion}")
    api("org.clever:clever-data-redis:${cleverVersion}")
    api("org.clever:clever-web:${cleverVersion}")
    api("org.clever:clever-security:${cleverVersion}")
    api("org.clever:clever-task:${cleverVersion}")
    api("org.clever:clever-task-ext:${cleverVersion}")
}
```

#### Gradleä½¿ç”¨(groovy)

```groovy
repositories {
    // å¢åŠ  maven ç§æœ
    maven {
        url "http://all.msvc.top:30005/api/packages/clever/maven/"
        allowInsecureProtocol = true
    }
}
// æŒ‡å®šç‰ˆæœ¬
ext.cleverVersion = "3.3.4.0-SNAPSHOT"
dependencies {
    // æŒ‰éœ€å¼•å…¥ä¾èµ–
    api("org.clever:clever-spring:${cleverVersion}")
    api("org.clever:clever-core:${cleverVersion}")
    api("org.clever:clever-data-jdbc:${cleverVersion}")
    api("org.clever:clever-data-redis:${cleverVersion}")
    api("org.clever:clever-web:${cleverVersion}")
    api("org.clever:clever-security:${cleverVersion}")
    api("org.clever:clever-task:${cleverVersion}")
    api("org.clever:clever-task-ext:${cleverVersion}")
}
```

ç¤ºä¾‹é¡¹ç›®: [clever-examples](https://github.com/Lzw2016/clever-examples)

## æ¨¡å—è¯´æ˜

<!--suppress HtmlDeprecatedAttribute -->
<table>
  <tr>
    <th style="text-align: left;width: 200px;" width="200px">æ¨¡å—å</th>
    <th style="text-align: center;width: 100px;" width="100x">å®Œæˆè¿›åº¦</th>
    <th style="text-align: left;">è¯´æ˜</th>
  </tr>
  <tr>
    <td style="text-align: left;">clever-spring</td>
    <td style="text-align: center;">å·²å®Œæˆ</td>
    <td style="text-align: left;">å¯¹springçš„è½»åº¦å°è£…ï¼Œä»¥é€‚åº”åº•å±‚æ¡†æ¶éœ€è¦</td>
  </tr>
  <tr>
    <td style="text-align: left;">clever-core</td>
    <td style="text-align: center;">å·²å®Œæˆ</td>
    <td style="text-align: left;">å°è£…å¸¸ç”¨çš„å·¥å…·ç±»: åºåˆ—åŒ–ååºåˆ—åŒ–ã€HTTPã€ç¼–ç è§£ç ã€IDç”Ÿæˆã€Beanè½¬æ¢éªŒè¯ã€Excelã€å¼‚å¸¸ã€éªŒè¯ç ç­‰ç­‰</td>
  </tr>
  <tr>
    <td style="text-align: left;">clever-data-dynamic-sql</td>
    <td style="text-align: center;">å·²å®Œæˆ</td>
    <td style="text-align: left;">å®Œå…¨å…¼å®¹mybatisè¯­æ³•çš„sqlæ¨¡ç‰ˆï¼Œå®ç°åŠ¨æ€sqlèƒ½åŠ›</td>
  </tr>
  <tr>
    <td style="text-align: left;">clever-data-commons</td>
    <td style="text-align: center;">å·²å®Œæˆ</td>
    <td style="text-align: left;">æ•°æ®è®¿é—®å±‚å…¬å…±èƒ½åŠ›å°è£…</td>
  </tr>
  <tr>
    <td style="text-align: left;">clever-data-jdbc</td>
    <td style="text-align: center;">å·²å®Œæˆ</td>
    <td style="text-align: left;">å‚è€ƒspring-jdbcå®ç°å¯¹JDBCæ“ä½œçš„è½»åº¦å°è£…ï¼ŒåŒæ—¶æ”¯æŒmybatisã€query-dslç”¨æ³•</td>
  </tr>
  <tr>
    <td style="text-align: left;">clever-data-jdbc-meta</td>
    <td style="text-align: center;">å·²å®Œæˆ</td>
    <td style="text-align: left;">å®ç°è¯»å–æ•°æ®åº“å…ƒæ•°æ®åŠŸèƒ½ï¼Œæ”¯æŒè¯»å–æ•°æ®åº“ï¼šè¡¨ç»“æ„ã€ç´¢å¼•ã€ä¸»é”®ã€åºåˆ—ã€å‡½æ•°ã€å­˜å‚¨è¿‡ç¨‹ã€‚å¹¶ä¸”æ”¯æŒæ•°æ®åº“æ•°æ®åŒæ­¥å’Œè¡¨ç»“æ„åŒæ­¥</td>
  </tr>
  <tr>
    <td style="text-align: left;">clever-data-redis</td>
    <td style="text-align: center;">å·²å®Œæˆ</td>
    <td style="text-align: left;">åŸºäºspring-data-rediså®ç°å¯¹Redisæ“ä½œçš„è½»åº¦å°è£…</td>
  </tr>
  <tr>
    <td style="text-align: left;">clever-data-mongodb</td>
    <td style="text-align: center;">æœªå¼€å§‹</td>
    <td style="text-align: left;">å®ç°å¯¹mongodbæ“ä½œçš„è½»åº¦å°è£…</td>
  </tr>
  <tr>
    <td style="text-align: left;">clever-data-rabbitmq</td>
    <td style="text-align: center;">è¿›è¡Œä¸­</td>
    <td style="text-align: left;">å®ç°å¯¹rabbitmqæ“ä½œçš„è½»åº¦å°è£…</td>
  </tr>
  <tr>
    <td style="text-align: left;">clever-data-rocketmq</td>
    <td style="text-align: center;">æœªå¼€å§‹</td>
    <td style="text-align: left;">å®ç°å¯¹rocketmqæ“ä½œçš„è½»åº¦å°è£…</td>
  </tr>
  <tr>
    <td style="text-align: left;">clever-data-kafka</td>
    <td style="text-align: center;">æœªå¼€å§‹</td>
    <td style="text-align: left;">å®ç°å¯¹kafkaæ“ä½œçš„è½»åº¦å°è£…</td>
  </tr>
  <tr>
    <td style="text-align: left;">clever-web</td>
    <td style="text-align: center;">å·²å®Œæˆ</td>
    <td style="text-align: left;">åŸºäºjavalinå°è£…servlet webæœåŠ¡å™¨çš„å®ç°,å‚è€ƒspring mvcéƒ¨åˆ†æ³¨è§£çš„å®ç°,æ”¯æŒweb mvcåŠ¨æ€è°ƒç”¨java class(åŒ…å«kotlinæˆ–groovyç­‰JVMè¯­è¨€,éœ€è¦ç¼–è¯‘å™¨æ”¯æŒ)</td>
  </tr>
  <tr>
    <td style="text-align: left;">clever-security</td>
    <td style="text-align: center;">å·²å®Œæˆ</td>
    <td style="text-align: left;">å®ç°ä¸€å¥—RBACæ¨¡å‹çš„æƒé™è®¤è¯åŠŸèƒ½</td>
  </tr>
  <tr>
    <td style="text-align: left;">clever-js-api</td>
    <td style="text-align: center;">å·²å®Œæˆ</td>
    <td style="text-align: left;">å®šä¹‰JavaScriptå¼•æ“API</td>
  </tr>
  <tr>
    <td style="text-align: left;">clever-js-graaljs</td>
    <td style="text-align: center;">å·²å®Œæˆ</td>
    <td style="text-align: left;">graaljså¼•æ“å®ç°(æ¨è)</td>
  </tr>
  <tr>
    <td style="text-align: left;">clever-js-nashorn</td>
    <td style="text-align: center;">å·²å®Œæˆ</td>
    <td style="text-align: left;">nashornå¼•æ“å®ç°</td>
  </tr>
  <tr>
    <td style="text-align: left;">clever-js-v8</td>
    <td style="text-align: center;">è¿›è¡Œä¸­</td>
    <td style="text-align: left;">v8å¼•æ“å®ç°</td>
  </tr>
  <tr>
    <td style="text-align: left;">clever-js-shim</td>
    <td style="text-align: center;">è¿›è¡Œä¸­</td>
    <td style="text-align: left;">ç”¨äºæ¡¥æ¥Javaä¸JSç»„ä»¶</td>
  </tr>
  <tr>
    <td style="text-align: left;">clever-openapi</td>
    <td style="text-align: center;">æœªå¼€å§‹</td>
    <td style="text-align: left;">è‡ªåŠ¨æ‰«æç”ŸæˆOpen APIæ¥å£æ–‡æ¡£(ç±»ä¼¼swaggeræ–‡æ¡£)</td>
  </tr>
</table>

#### ç³»ç»Ÿæ—¥å¿—é…ç½®

```yaml
logging:
    config: classpath:logback-spring.xml
    file:
        name: '${clever.name:server}'
        path: './logs/${logging.file.name}'
    level:
        root: info
        org.springframework.jdbc.datasource.DataSourceTransactionManager: info
        org.springframework.jdbc.datasource.DataSourceUtils: info
        org.springframework.core.HotReloadClassLoader: debug
        org.springframework.security: debug
        com.zaxxer.hikari.HikariConfig: debug
```

ç³»ç»Ÿæ—¥å¿—é…ç½®ä¸SpringBooté…ç½®ä¸€è‡´ã€‚

#### åŸºç¡€é…ç½®

```yaml
app:
    # ç”¨äºè®¾ç½®åº”ç”¨çš„æ ¹è·¯å¾„ï¼Œå…¶å®ƒè·¯å¾„é…ç½®é¡¹çš„ç›¸å¯¹è·¯å¾„å°±æ˜¯è¿™ä¸ªé…ç½®
    root-path: './'

# å•èŠ‚ç‚¹å®šæ—¶ä»»åŠ¡
startup-task:
    pool-size: 8
    timed-task:
        - name: 'æµ‹è¯•å®šæ—¶ä»»åŠ¡'
          enable: true
          interval: 120s
          clazz: 'org.clever.app.task.TaskTest'
          method: 'job01'
    cmd-task:
        - name: 'æŒç»­ç¼–è¯‘æºç '
          enable: false
          async: true
          work-dir: './'
          cmd:
              windows: 'gradlew.bat classes --continuous --watch-fs --build-cache --configuration-cache --configuration-cache-problems=warn'
              linux: './gradlew     classes --continuous --watch-fs --build-cache --configuration-cache --configuration-cache-problems=warn'
              macos: './gradlew     classes --continuous --watch-fs --build-cache --configuration-cache --configuration-cache-problems=warn'
```

#### JDBCæ•°æ®æºé…ç½®

```yaml
jdbc:
    enable: true
    # sqlæ—¥å¿—é…ç½®
    p6spylog:
        enable: true
        slow: 800
        ignore-sql:
            - 'select 1'
            - 'select 1 from dual'
            - 'select now()'
            - 'select now(6) from dual'
        ignore-contains-sql:
            - 'pg_advisory'
            - 'pg_try_advisory'
        ignore-thread:
            - 'task-scheduler-pool-'
    # sqlæ€§èƒ½ç»Ÿè®¡é…ç½®
    metrics:
        enable: true
        max-sql-count: 200
        histogram: [ 20, 50, 100, 200, 500, 1000, 2000, 5000, 20000 ]
        histogram-top-n: 3
    # å…¨å±€æ•°æ®æºé…ç½®
    global:
        driver-class-name: 'com.p6spy.engine.spy.P6SpyDriver'
        autocommit: true
        maximum-pool-size: 100
        minimum-idle: 5
        max-lifetime: 21600000
        connection-timeout: 30000
        connection-test-query: 'select 1'
        exception-override-class-name: 'org.clever.data.jdbc.hikari.HikariPreventQueryTimeoutEviction'
    # è®¾ç½®é»˜è®¤æ•°æ®æº
    default-name: 'mysql'
    # å¤šæ•°æ®æºé…ç½®
    data-source:
        mysql:
            jdbc-url: jdbc:p6spy:mysql://127.0.0.1:3306/test
            username: admin
            password: 123456
            minimum-idle: 2
            maximum-pool-size: 100
            connection-test-query: 'select 1 from dual'
        postgresql:
            jdbc-url: jdbc:p6spy:postgresql://127.0.0.1:5432/test
            username: admin
            password: 123456
            minimum-idle: 2
            maximum-pool-size: 100
            connection-test-query: 'select 1'
            data-source-properties:
                stringtype: unspecified
```

ä»£ç ä½¿ç”¨ï¼š

```java
// è·å–é»˜è®¤çš„æ•°æ®æº
private static final Jdbc jdbc = DaoFactory.getJdbc();
private static final QueryDSL queryDSL = DaoFactory.getQueryDSL();

// æˆ–è€…æŒ‡å®šçš„æ•°æ®æº
private static final Jdbc jdbc = DaoFactory.getJdbc("data-source-name");
private static final QueryDSL queryDSL = DaoFactory.getQueryDSL("data-source-name");
```

#### Redisæ•°æ®æº

```yaml
redis:
    enable: true
    # æ•°æ®æºå…¨å±€é…ç½®
    global:
        mode: standalone
        ssl: false
        read-timeout: 30s
        connect-timeout: 10s
        shutdown-timeout: 100ms
        client-name: 'xxx-app'
        pool:
            enabled: true
            max-idle: 8
            min-idle: 0
            max-active: 8
            max-wait: 30s
            time-between-eviction-runs: 1m
    # è®¾ç½®é»˜è®¤çš„æ•°æ®æº
    default-name: 'default'
    # å¤šæ•°æ®æºé…ç½®
    data-source:
        default:
            mode: standalone
            standalone:
                host: '192.168.1.211'
                port: 30007
                database: 0
                password: 'admin123456'
```

ä»£ç ä½¿ç”¨ï¼š

```java
// è·å–é»˜è®¤çš„æ•°æ®æº
private static final Redis redis = RedisAdmin.getRedis();

// æˆ–è€…æŒ‡å®šçš„æ•°æ®æº
private static final Redis redis = RedisAdmin.getRedis("data-source-name");
```

#### MVCé…ç½®

```yaml
web:
    mvc:
        path: '/api/'
        http-method: [ 'POST', 'GET' ]
        package-mapping:
            - path-prefix: '/app'
              package-prefix: 'org.clever.app.mvc'
            - path-prefix: '/task'
              package-prefix: 'org.clever.task.manage.mvc'
        allow-packages:
            - 'org.clever.app.mvc.'
            - 'org.clever.task.manage.mvc.'
        transactional-def-datasource: [ ]
        def-transactional:
            datasource: [ ]
            timeout: -1
            read-only: false
        # çƒ­é‡è½½é…ç½®
        hot-reload:
            enable: true
            # watchFile: './build/.hotReload'
            interval: 1s
            exclude-packages:
                - 'org.clever.task.core.model'
            exclude-classes:
                - 'org.clever.task.core.model.JobInfo'
                - 'org.clever.task.core.model.AbstractTrigger'
                - 'org.clever.task.core.job.JobContext'
            locations:
                - './clever-examples-javalin/out/production/classes'
                - './clever-task/out/production/classes'
                #- './clever-examples-javalin/build/classes/java/main'
                #- './clever-examples-javalin/build/classes/kotlin/main'
```

å†…ç½®çš„è¿‡æ»¤å™¨é“¾ï¼š

```text
ğŸ¡“
ApplyConfigFilter (åº”ç”¨webé…ç½®,å¦‚: ContentTypeã€CharacterEncoding ç­‰ç­‰)
ğŸ¡“
EchoFilter(è¯·æ±‚æ—¥å¿—)
ğŸ¡“
ExceptionHandlerFilter (å¼‚å¸¸å¤„ç†)
ğŸ¡“
GlobalRequestParamsFilter (è·å–å…¨å±€è¯·æ±‚å‚æ•°: QueryBySortã€QueryByPage)
ğŸ¡“
CorsFilter (è·¨åŸŸå¤„ç†)
ğŸ¡“
MvcHandlerMethodFilter (è§£æè·å–MVCçš„HandlerMethod)
ğŸ¡“
SecurityFilter (è®¤è¯æˆæƒ)
    ğŸ¡“
    AuthenticationFilter
    ğŸ¡“
    LoginFilter
    ğŸ¡“
    LogoutFilter
    ğŸ¡“
    AuthorizationFilter
    ğŸ¡“
ğŸ¡“
StaticResourceFilter (é™æ€èµ„æºæ˜ å°„)
ğŸ¡“
MvcFilter (before[å¯æå‰å“åº”è¯·æ±‚] -> invokeMethod[è‡ªå®šä¹‰MVC: å“åº”è¯·æ±‚] -> after -> finally[æ‰§è¡Œbeforeåä¸€å®šä¼šæ‰§è¡Œ, å¯ä»¥å¤„ç†å¼‚å¸¸])
    ğŸ¡“
    HandlerInterceptor
        ğŸ¡“
        ArgumentsValidated (MVCæ•°æ®éªŒè¯@Validated)
        ğŸ¡“
        TransactionInterceptor (JDBCäº‹åŠ¡å¤„ç†)
        ğŸ¡“
    ğŸ¡“
ğŸ¡“
```

å†…ç½®å‡½æ•°å¼MVCæ”¯æŒçš„æ³¨è§£:

| å†…ç½®æ³¨è§£                                          | å…¼å®¹Springæ³¨è§£      | ç”¨é€”                      |
|:----------------------------------------------|:----------------|:------------------------|
| `org.clever.web.mvc.annotation.RequestBody`   | `RequestBody`   | è¯»å–è¯·æ±‚bodyå‚æ•°              |
| `org.clever.web.mvc.annotation.RequestParam`  | `RequestParam`  | è¯»å–è¯·æ±‚æŸ¥è¯¢å­—ç¬¦ä¸²æˆ–è¡¨å•å‚æ•°          |
| `org.clever.web.mvc.annotation.RequestPart`   | `RequestPart`   | è¯»å–è¯·æ±‚æ–‡ä»¶ä¸Šä¼ å‚æ•°              |
| `org.clever.web.mvc.annotation.RequestHeader` | `RequestHeader` | è¯»å–HTTPè¯·æ±‚å¤´å‚æ•°             |
| `org.clever.web.mvc.annotation.CookieValue`   | `CookieValue`   | è¯»å–HTTP cookieå‚æ•°         |
| `org.clever.web.mvc.annotation.Validated`     | `Validated`     | å¯ç”¨è¯·æ±‚å‚æ•°éªŒè¯(æ”¯æŒJSR 303éªŒè¯æ³¨è§£) |
| `org.clever.web.mvc.annotation.Transactional` | `Transactional` | è®¾ç½®JDBCæ•°æ®æºäº‹åŠ¡             |

#### å®‰å…¨è®¤è¯é…ç½®

```yaml
web:
    security:
        enable: false
        ignore-paths:
            - '/favicon.ico'
            - '/dist/**'
            - '/static/**'
            - '/**/*.png'
            - '/**/*.ico'
            - '/**/*.js'
            - '/**/*.css'
            - '/**/*.html'
            - '/**/*.ts'
            - '/**/*.tsx'
            - '/**/*.map'
            - '/**/*.png'
            - '/**/*.jpg'
            - '/**/*.gif'
            - '/**/*.ttf'
            - '/**/*.woff'
            - '/**/*.woff2'
            - '/**/.git'
        ignore-auth-paths: [ ]
        ignore-auth-failed-paths: [ ]
        current-user-path: '/current_user'
        login:
            paths: [ '/login' ]
            post-only: true
            allow-repeat-login: true
            concurrent-login-count: 1
            allow-after-login: true
        logout:
            path: '/logout'
        token:
            secret-key: 'security'
            token-validity: 30d
            jwt-token-name: 'authorization'
            refresh-token-name: 'refresh-token'
        data-source:
            jdbc-name: "mysql"
            enable-redis: true
            redis-name: "default"
            redis-namespace: "security"
```

è®¤è¯æˆæƒè¿‡æ»¤å™¨é“¾ï¼š

```text
ğŸ¡“
AuthenticationFilter - èº«ä»½è®¤è¯æ‹¦æˆª (è¯»å–è¯·æ±‚token -> ä½¿ç”¨åˆ·æ–°token(RefreshJwtToken) -> éªŒè¯token(VerifyJwtToken) -> åŠ è½½SecurityContextå¹¶ç»‘å®šåˆ°å½“å‰çº¿ç¨‹(SecurityContextRepository))
ğŸ¡“
LoginFilter          - ç™»å½•æ‹¦æˆª (æ”¶é›†ç™»å½•æ•°æ®(LoginDataCollect) -> æ ¡éªŒç™»å½•æ•°æ®(VerifyLoginData) -> åŠ è½½ç”¨æˆ·ä¿¡æ¯(LoadUser) -> æ ¡éªŒç”¨æˆ·ä¿¡æ¯(VerifyUserInfo) -> åˆ›å»ºtoken(AddJwtTokenExtData) -> ç¼“å­˜SecurityContext(SecurityContextRepository))
ğŸ¡“
LogoutFilter         - ç™»å‡ºæ‹¦æˆª (åˆ é™¤Token)
ğŸ¡“
AuthorizationFilter  - æƒé™æˆæƒæ‹¦æˆª (è·å–SecurityContext -> æˆæƒæŠ•ç¥¨å™¨å¼€å§‹æŠ•ç¥¨(è‡ªå®šä¹‰) -> æ ¹æ®æŠ•ç¥¨ç»“æœåˆ¤æ–­æ˜¯å¦æˆæƒé€šè¿‡)
    AuthorizationVoter(æˆæƒæŠ•ç¥¨å™¨)
ğŸ¡“
```

#### åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡é…ç½®

```yaml
timed-task:
    enable: true
    standby: true
    jdbc-name: 'postgresql'
    namespace: 'default'
    instance-name: 'node01'
    description: 'devèŠ‚ç‚¹01'
    heartbeat-interval: 10000
    scheduler-executor-pool-size: 16
    job-executor-pool-size: 64
    job-executor-queue-size: 64
    load-weight: 1.0
    shell-job-working-dir: './shell_job_log'
    log-retention: 3d
    js-executor:
        engine-pool:
            max-idle: 8
            min-idle: 0
            max-total: 8
            max-wait: 30s
```
